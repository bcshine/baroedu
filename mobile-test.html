<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ì¸ì¦ ìƒíƒœ í…ŒìŠ¤íŠ¸ - ë°”ë¡œêµìœ¡</title>
    
    <!-- Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .status-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #2c5aa0;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .status-logged-out {
            color: #dc3545;
        }
        
        .status-logged-in {
            color: #28a745;
        }
        
        .user-info {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #2c5aa0;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1e3d6f;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .test-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .test-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .page-links {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .page-link {
            display: block;
            background: #e9ecef;
            color: #495057;
            text-decoration: none;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .page-link:hover {
            background: #dee2e6;
        }
        
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 3px 0;
        }
        
        .log-success {
            color: #28a745;
        }
        
        .log-error {
            color: #dc3545;
        }
        
        .log-info {
            color: #17a2b8;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” ì¸ì¦ ìƒíƒœ í…ŒìŠ¤íŠ¸</h1>
            <p>ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”</p>
        </div>
        
        <!-- ì¸ì¦ ìƒíƒœ í‘œì‹œ -->
        <div class="status-card">
            <div class="status-indicator" id="statusIndicator">
                <span id="statusIcon">ğŸ”´</span>
                <span id="statusText">ë¡œê·¸ì•„ì›ƒ ìƒíƒœ</span>
            </div>
            <div id="userInfo" class="user-info">
                <strong>ì‚¬ìš©ì ì •ë³´:</strong><br>
                <span id="userEmail">-</span>
            </div>
        </div>
        
        <!-- ì¸ì¦ ë²„íŠ¼ë“¤ -->
        <div id="authButtons">
            <button class="btn btn-primary" onclick="showLoginForm()">
                ğŸ”‘ í…ŒìŠ¤íŠ¸ ë¡œê·¸ì¸
            </button>
            <button class="btn btn-secondary" onclick="testGoogleLogin()">
                ğŸŒ Google ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
            </button>
        </div>
        
        <div id="loggedInButtons" class="hidden">
            <button class="btn btn-danger" onclick="testLogout()">
                ğŸšª ë¡œê·¸ì•„ì›ƒ
            </button>
        </div>
        
        <!-- í˜ì´ì§€ ì´ë™ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h3>ğŸ“„ í˜ì´ì§€ ì´ë™ í…ŒìŠ¤íŠ¸</h3>
            <p>ë¡œê·¸ì¸ í›„ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™í•´ì„œ ìƒíƒœê°€ ìœ ì§€ë˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:</p>
            <div class="page-links">
                <a href="index.html" class="page-link">ğŸ  ë©”ì¸ í˜ì´ì§€</a>
                <a href="courses.html" class="page-link">ğŸ“š ê°•ì¢Œ ëª©ë¡</a>
                <a href="course-detail.html" class="page-link">ğŸ“– ê°•ì¢Œ ìƒì„¸</a>
            </div>
        </div>
        
        <!-- ë¡œê·¸ ì˜ì—­ -->
        <div class="log-area" id="logArea">
            <div class="log-entry log-info">ğŸ“‹ ì¸ì¦ ì‹œìŠ¤í…œ ë¡œê·¸</div>
        </div>
    </div>

    <script>
        // ë¡œê·¸ í•¨ìˆ˜
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        // Supabase ì„¤ì •
        const SUPABASE_URL = 'https://nvtxwrpfskqwzzcniahm.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im52dHh3cnBmc2txd3p6Y25pYWhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzNDUzOTIsImV4cCI6MjA2NjkyMTM5Mn0.imfzzFkUjaPO8gCpDuPpWQo_wf6IhQjMtHX68sX1Fpk';

        let supabase;

        // Supabase ì´ˆê¸°í™”
        function initSupabase() {
            try {
                const SupabaseLib = window.supabase || window.Supabase;
                
                if (typeof SupabaseLib === 'undefined') {
                    addLog('âŒ Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨', 'error');
                    return null;
                }
                
                supabase = SupabaseLib.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                addLog('âœ… Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
                return supabase;
                
            } catch (error) {
                addLog(`âŒ Supabase ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`, 'error');
                return null;
            }
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI(user = null) {
            const statusIcon = document.getElementById('statusIcon');
            const statusText = document.getElementById('statusText');
            const statusIndicator = document.getElementById('statusIndicator');
            const userInfo = document.getElementById('userInfo');
            const userEmail = document.getElementById('userEmail');
            const authButtons = document.getElementById('authButtons');
            const loggedInButtons = document.getElementById('loggedInButtons');

            if (user) {
                // ë¡œê·¸ì¸ ìƒíƒœ
                statusIcon.textContent = 'ğŸŸ¢';
                statusText.textContent = 'ë¡œê·¸ì¸ ìƒíƒœ';
                statusIndicator.className = 'status-indicator status-logged-in';
                userInfo.style.display = 'block';
                userEmail.textContent = user.email;
                authButtons.className = 'hidden';
                loggedInButtons.className = '';
                
                addLog(`âœ… ë¡œê·¸ì¸ ìƒíƒœ: ${user.email}`, 'success');
            } else {
                // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ
                statusIcon.textContent = 'ğŸ”´';
                statusText.textContent = 'ë¡œê·¸ì•„ì›ƒ ìƒíƒœ';
                statusIndicator.className = 'status-indicator status-logged-out';
                userInfo.style.display = 'none';
                authButtons.className = '';
                loggedInButtons.className = 'hidden';
                
                addLog('â„¹ï¸ ë¡œê·¸ì•„ì›ƒ ìƒíƒœ', 'info');
            }
        }

        // í…ŒìŠ¤íŠ¸ ë¡œê·¸ì¸
        function showLoginForm() {
            const email = prompt('í…ŒìŠ¤íŠ¸ìš© ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”:') || 'test@example.com';
            const password = prompt('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:') || 'test123456';
            
            testLogin(email, password);
        }

        async function testLogin(email, password) {
            if (!supabase) {
                addLog('âŒ Supabaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            try {
                addLog(`ğŸ”„ ë¡œê·¸ì¸ ì‹œë„: ${email}`, 'info');
                
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) {
                    // ê³„ì •ì´ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ìƒì„±
                    if (error.message.includes('Invalid login credentials')) {
                        addLog('ğŸ“ ê³„ì •ì´ ì—†ì–´ì„œ ìë™ ìƒì„±í•©ë‹ˆë‹¤...', 'info');
                        await testSignup(email, password);
                        return;
                    }
                    throw error;
                }

                addLog('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                updateUI(data.user);

            } catch (error) {
                addLog(`âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function testSignup(email, password) {
            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password
                });

                if (error) throw error;

                addLog('âœ… íšŒì›ê°€ì… ì„±ê³µ! ìë™ ë¡œê·¸ì¸ë©ë‹ˆë‹¤.', 'success');
                updateUI(data.user);

            } catch (error) {
                addLog(`âŒ íšŒì›ê°€ì… ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // Google ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
        async function testGoogleLogin() {
            if (!supabase) {
                addLog('âŒ Supabaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            try {
                addLog('ğŸ”„ Google ë¡œê·¸ì¸ ì‹œì‘...', 'info');
                
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.href
                    }
                });

                if (error) throw error;
                
                addLog('âœ… Google ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œì‘', 'success');

            } catch (error) {
                addLog(`âŒ Google ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ í…ŒìŠ¤íŠ¸
        async function testLogout() {
            if (!supabase) {
                addLog('âŒ Supabaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            try {
                addLog('ğŸ”„ ë¡œê·¸ì•„ì›ƒ ì‹œë„...', 'info');
                
                const { error } = await supabase.auth.signOut();
                
                if (error) throw error;
                
                addLog('âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ!', 'success');
                updateUI();

            } catch (error) {
                addLog(`âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // ì„¸ì…˜ ë³µì›
        async function restoreSession() {
            if (!supabase) return;

            try {
                addLog('ğŸ”„ ì„¸ì…˜ ë³µì› ì‹œë„...', 'info');
                
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) throw error;
                
                if (session) {
                    addLog('âœ… ê¸°ì¡´ ì„¸ì…˜ ë³µì› ì™„ë£Œ', 'success');
                    updateUI(session.user);
                } else {
                    addLog('â„¹ï¸ ë³µì›í•  ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤', 'info');
                    updateUI();
                }

            } catch (error) {
                addLog(`âŒ ì„¸ì…˜ ë³µì› ì‹¤íŒ¨: ${error.message}`, 'error');
                updateUI();
            }
        }

        // ì¸ì¦ ìƒíƒœ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ
        function setupAuthListener() {
            if (!supabase) return;

            supabase.auth.onAuthStateChange((event, session) => {
                addLog(`ğŸ”„ ì¸ì¦ ìƒíƒœ ë³€ê²½: ${event}`, 'info');
                
                if (session) {
                    updateUI(session.user);
                } else {
                    updateUI();
                }
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async function() {
            addLog('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'info');
            
            // Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ëŒ€ê¸°
            let attempts = 0;
            const maxAttempts = 50;
            
            const waitForSupabase = () => {
                return new Promise((resolve) => {
                    const checkSupabase = () => {
                        attempts++;
                        
                        if (window.supabase || window.Supabase) {
                            resolve(true);
                        } else if (attempts >= maxAttempts) {
                            resolve(false);
                        } else {
                            setTimeout(checkSupabase, 100);
                        }
                    };
                    checkSupabase();
                });
            };
            
            const isSupabaseLoaded = await waitForSupabase();
            
            if (isSupabaseLoaded) {
                const supabaseClient = initSupabase();
                
                if (supabaseClient) {
                    setupAuthListener();
                    await restoreSession();
                    addLog('âœ… ì¸ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
                }
            } else {
                addLog('âŒ Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨', 'error');
            }
        });
    </script>
</body>
</html>